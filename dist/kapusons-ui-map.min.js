!function(e,t){"use strict";"function"==typeof define&&define.amd?define(["jquery"],function(i){return t(i,e,e.document,e.Math)}):"object"==typeof exports&&exports?module.exports=t(require("jquery"),e,e.document,e.Math):t(jQuery,e,e.document,e.Math)}("undefined"!=typeof window?window:this,function(e,t,i,o,n){"use strict";var a="kmap-enabled";e(t),e(i);e.fn.kapusonsUiMap=function(o){function n(){var e=!1;return(/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|ipad|iris|kindle|Android|Silk|lge |maemo|midp|mmp|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows (ce|phone)|xda|xiino/i.test(navigator.userAgent)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(navigator.userAgent.substr(0,4)))&&(e=!0),e}function s(){m.data.setStyle(function(t){var i=t.getProperty("selected")?o.features.fillColorSelected:o.features.fillColor;return e.extend(o.features,{fillColor:i})})}function l(n,a){var s=n.f.items;if(!s)return!1;for(var l=[],r=new google.maps.InfoWindow,p=0;p<s.length;p++){var c=s[p].lat,d=s[p].lng;if(c&&d){var m=new google.maps.LatLng(c,d);l.push(m);var u=new google.maps.Marker({id:s[p].id,name:s[p].name,title:s[p].title,address:s[p].address,city:s[p].city,website:s[p].website,email:s[p].email,phone:s[p].phone,url:s[p].url,position:m,map:a});g.push(u),google.maps.event.addListener(u,"click",function(t,i){var o='<div class="infowindow"><h3>'+t.name+'</h3><div class="info">'+(t.title?' <div class="info-title"><span>'+t.title+"</span></div>":"")+(t.city?' <div><span class="label">City:</span> <span>'+t.city+"</span></div>":"")+(t.address?' <div><span class="label">Address:</span> <span>'+t.address+"</span></div>":"")+(t.phone?' <div><span class="label">Phone:</span> <span>'+t.phone+"</span></div>":"")+(t.email?' <div><span class="label">Email:</span> <span><a href="mailto:'+t.email+'">'+t.email+"</a></span></div>":"")+(t.website?' <div><span class="label">Website:</span> <span><a href="'+t.website+'" target="_blank">'+t.website+"</a></span></div>":"")+(t.url?' <a href="'+t.url+'" class="scheda-trigger">Details</a>':"")+" </div></div>";return e(".region-list-wrapper").append(o),function(){i.close(),i.setContent(o),setTimeout(function(){i.open(a,t)},300),setTimeout(function(){a.setZoom(12),a.setCenter(t.getPosition())},500)}}(u,r))}}o.showRegionTooltip&&(i.getElementById("region-tooltip").style.display="none"),function(e,i){for(var o=new google.maps.LatLngBounds,n=0,a=e.length;n<a;n++)o.extend(e[n]);i.setCenter(o.getCenter()),i.setZoom(t.innerWidth>600?8:7)}(l,a)}function r(){if(n()){var t=0;e(".map-region-description-body").length?(t+=e(".map-region-description-body").outerHeight(!0),t+=parseInt(e("#map-region-description > h3").css("height").replace(/px/gi,"")),t+=e(".navigation-wrapper").outerHeight(!0)):e(".col-left").hasClass("open")?(e(".region-list-wrapper li, .region-list-wrapper > div").each(function(){t+=e(this).outerHeight(!0)}),t+=e(".navigation-wrapper").outerHeight(!0)):t="100vh",e(".map-wrapper").css({height:t}),e("html, body").scrollTop()>0&&e("html, body").animate({scrollTop:e(".map-wrapper").offset().top},800)}}function p(e,t){console&&console[e]&&console[e]("Kapusons-ui-map: "+t)}if(e("html").hasClass(a))p("error","Kapuosns-ui-map can only be initialized once and you are doing it multiple times!");else{e("html, body"),e("body"),e.fn.kapusonsUiMap;o=e.extend(!0,{dataSource:"json/world.subset.json",mapTitle:"Regions",showLeftColumn:!0,showRegionTooltip:!0,showRegionDetail:!0,map:{center:{lat:38.513456,lng:44.5239},zoom:5,scrollwheel:!1,gestureHandling:"cooperative",mapTypeControlOptions:{style:google.maps.MapTypeControlStyle.DEFAULT},styles:[{featureType:"all",elementType:"labels",stylers:[{visibility:"off"}]}]},features:{fillColor:"#3367D6",fillColorSelected:"#4285F4",strokeWeight:1.5,strokeColor:"#96C7FC",fillOpacity:1},regionOnClick:null,onMapLoaded:null},o);var c,d=e(this),g=[];if(e(this).length){!function(){d.css({height:e(t).height()>=900?e(t).height():"100vh"}),o.showLeftColumn||d.addClass("full-width");var s="";s+=(o.showLeftColumn?'\t<div class="col-left">\t\t<div class="navigation-wrapper"> \t\t\t<div class="navigation-header"> \t\t\t\t<h2>'+o.mapTitle+'</h2> \t\t\t</div> \t\t\t<div class="region-list-wrapper"> \t\t\t\t<ul class="region-list"></ul> \t\t\t</div> \t\t</div> \t\t<a class="mobile-handler" href="#"><span class="fa fa-caret-right fa-lg"></span></a> \t\t<a class="mobile-close" href="#"><img src="img/x.png" /></a>\t</div>':"")+'\t<div id="map-canvas"></div>'+(o.showRegionTooltip?'\t\t<div id="region-tooltip"></div>':"")+(o.showRegionDetail?'\t\t<div id="map-region-description"></div>':""),e(s).appendTo(d),!n()&&o.showLeftColumn&&(c=new PerfectScrollbar(".region-list-wrapper",{wheelPropagation:!0})),o.showLeftColumn&&(e(i).on("click",".region-list-wrapper .infowindow h3",function(){var t=e(".region-list-wrapper .infowindow").index(e(this).closest(".infowindow"));e(".col-left").removeClass("open"),google.maps.event.trigger(g[t],"click"),r()}),e(".mobile-handler").on("click",function(t){t.preventDefault(),e(".col-left").toggleClass("open"),r()}),e(".mobile-close").on("click",function(t){t.preventDefault(),e(".close-region-detail").trigger("click"),e(".col-left").toggleClass("open"),r()}),e(".col-left .navigation-header").on("click",function(t){e(".region-list > li.active .close-region-detail").trigger("click")})),o.showRegionDetail&&(e(i).on("click",".scheda-trigger",function(t){t.preventDefault();var i=e(this).attr("href");e.ajax({url:i,type:"GET"}).done(function(t){e("#map-region-description").show().css({opacity:0}).html(t),r(),e("#map-region-description").css({opacity:1}),n()?e(".col-left").hasClass("open")||e(".mobile-handler").trigger("click"):e(".map-region-description-body").height()>e("#map-region-description").height()-e("#map-region-description > h3").height()&&(e(".map-region-description-body").css({height:e("#map-region-description").height()-e("#map-region-description > h3").height()}),new PerfectScrollbar(".map-region-description-body",{wheelPropagation:!0}))})}),e(i).on("click",".close-region-description",function(t){t.preventDefault(),e("#map-region-description").fadeOut(function(){e(this).empty(),r()})})),e("html").addClass(a)}();var m=new google.maps.Map(e("#map-canvas").get(0),o.map);e.getJSON(o.dataSource,function(e){m.data.addGeoJson(e,{idPropertyName:"name"})}),s(),m.data.addListener("addfeature",function(t){if(o.showLeftColumn){var i=t.feature,a=i.f.name,l=e('<li data-region="'+a.toLowerCase()+'"></li>'),p=e('<a href="#" class="region-name">'+a+"</a>"),d=e('<a href="#" class="close-region-detail"><img src="img/x.png"></a>');l.append(p).append(d),p.on({mouseenter:function(){google.maps.event.trigger(m.data,"mouseover",{feature:i})},mouseleave:function(){google.maps.event.trigger(m.data,"mouseout",{feature:i})},click:function(t){t.preventDefault(),t.stopPropagation();if(e(this).closest("li").hasClass("active"))return!1;google.maps.event.trigger(m.data,"click",{feature:i}),r(),setTimeout(function(){n()||(c.update(),e(".region-list-wrapper").get(0).scrollTop=0)},500)}}),e(".region-list").append(l),d.on("click",function(t){t.preventDefault(),function(){for(var e=0;e<g.length;e++)g[e].setMap(null);g.length=0}(),function(e){m.setOptions({center:e,zoom:o.map.zoom})}(o.map.center),s(),m.setOptions({styles:[{featureType:"all",elementType:"labels",stylers:[{visibility:"off"}]}]}),e("#map-region-description").empty().hide(),e(".region-list-wrapper").removeClass("region-selected"),e(".region-list-wrapper").append(e(".region-list")),e(".region-list-wrapper .infowindow").remove(),e(this).closest("li").removeClass("active").siblings().fadeIn(),r(),setTimeout(function(){n()||(c.update(),e(".region-list-wrapper").get(0).scrollTop=0)},500)})}}),m.data.addListener("mouseover",function(e){if(n())return!1;o.showRegionTooltip&&(i.getElementById("region-tooltip").textContent=e.feature.getId(),i.getElementById("region-tooltip").style.display="inline"),m.data.overrideStyle(e.feature,{fillColor:o.features.fillColorSelected})}),m.data.addListener("mouseout",function(e){if(n())return!1;o.showRegionTooltip&&(i.getElementById("region-tooltip").style.display="none"),e.feature.setProperty("fillColor",o.features.fillColor),m.data.revertStyle()}),m.data.addListener("mousedown",function(e){e.va&&(m.clickX=e.va.clientX,m.clickY=e.va.clientY)}),m.data.addListener("click",function(t){var i=t.feature;if(t.va&&(t.va.clientY>m.clickY+30||t.va.clientY<m.clickY-30))return!1;if(e.isFunction(o.regionOnClick))o.regionOnClick.call(t,i);else{if(o.showLeftColumn){var n=e('.region-list > li[data-region="'+i.f.name.toLowerCase()+'"]');e(".region-list-wrapper").addClass("region-selected"),e(".navigation-header").after(e(".region-list")),e(".region-list > li").removeClass("active"),n.addClass("active"),n.siblings().hide()}m.data.setStyle(function(e){return{visible:!1}}),m.setOptions({styles:[{stylers:[{visibility:"on"}]}]}),l(i,m)}}),i.body.onmousemove=function(t){o.showRegionTooltip&&(o.showLeftColumn&&e(t.target).closest(".region-list").length?e("#region-tooltip").hide():(i.getElementById("region-tooltip").style.left=t.clientX+25+"px",i.getElementById("region-tooltip").style.top=t.clientY-(e("#map-canvas").offset().top-e(i).scrollTop())+"px"))},google.maps.event.addListenerOnce(m,"idle",function(){e.isFunction(o.onMapLoaded)&&o.onMapLoaded.call()})}else p("log","no dom element found")}}});